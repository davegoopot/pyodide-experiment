<!DOCTYPE html>
<!--
    Simple HTML page offer a button to load a random number. On pressing the
    button the page uses Pyodide to fetch a random number using the
    randomfetch.py module.
-->
<html>
<head>
    <title>Random Fetch</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
</head>
<body>
    <h1>Random Fetch</h1>
    <button onclick="loadPyodideAndRun()">Fetch Random Number</button>
    <p>Random Number: <span id="random_number"></span></p>
    <script>
        async function loadImports(pyodide) {
            await pyodide.loadPackage("requests");
        }

        async function loadOurCode(pyodide) {
            await pyodide.runPythonAsync(`
                from pyodide.http import pyfetch
                response = await pyfetch("randomfetch.py")
                with open("randomfetch.py", "wb") as f:
                    f.write(await response.bytes())
            `)
            let randomfectch = pyodide.pyimport("randomfetch");
            return randomfectch;
        }

        async function main() {
            let pyodide = await loadPyodide();
            await loadImports(pyodide);
            let randomfectch = await loadOurCode(pyodide);
        
            let greeting = randomfectch.helloWorld();
            console.log(`Greeting from Python: ${greeting}`);

            let random_number = randomfectch.getRandomNumber();
            console.log(`Random Number from Python: ${random_number}`);
        };
        main();
        
    </script>
</body>
</html>